

  index
    PAGE_SIZE
      Rows of data per page
        ✓ default 10
        ✓ Integer
    DOMAIN
      Domain of server
        ✓ default unset
        ✓ String
    HOST
      IP or address web server listens on
        ✓ default localhost
        ✓ IP address
    PORT
      Port web server listens on
        ✓ default 8000
        ✓ Integer
    ID_LENGTH
      Length of random ID
        ✓ default 8
        ✓ Integer
    ALLOW_PUBLIC_API
      Allow HTTP access to /api
        ✓ default false
        ✓ Boolean
    DELETE_DELAY
      Cool-down time in days to delete accounts
        ✓ default 7
        ✓ Integer
    APPLICATION_SERVER
      URL of application server
        ✓ Address
    APPLICATION_SERVER_TOKEN
      Secret shared between servers
        ✓ String
    BCRYPT_WORKLOAD_FACTOR
      Strength to protect passwords
        ✓ default 10
        ✓ Integer
    ENCRYPTION_SECRET
      32-character secret string
        ✓ String
    ENCRYPTION_SECRET_IV
      16-character secret string
        ✓ String
    LANGUAGE
      Default, fixed or selectable UI language
        ✓ default en
        ✓ Languages folder name
    ENABLE_LANGUAGE_PREFERENCE
      Allows users to customize language, timezone and formats
        ✓ default unset
        ✓ Boolean
    DISABLE_REGISTRATION
      Disable UI (not API) for registering
        ✓ default unset
        ✓ Boolean
    DASHBOARD_SERVER
      URL of dashboard server
        ✓ default unset
        ✓ Address
    MINIMUM_PASSWORD_LENGTH
      Shortest password length
        ✓ default 1
        ✓ Integer
    MAXIMUM_PASSWORD_LENGTH
      Longest password length
        ✓ default 50
        ✓ Integer
    MINIMUM_USERNAME_LENGTH
      Shortest username length
        ✓ default 1
        ✓ Integer
    MAXIMUM_USERNAME_LENGTH
      Longest username length
        ✓ default 50
        ✓ Integer
    MINIMUM_RESET_CODE_LENGTH
      Shortest reset code length
        ✓ default 6
        ✓ Integer
    MAXIMUM_RESET_CODE_LENGTH
      Longest reset code length
        ✓ default 50
        ✓ Integer
    REQUIRE_PROFILE
      Require registration information
        ✓ default unset
        ✓ Integer
    USER_PROFILE_FIELDS
      Information to collect at registration
        ✓ default contact-email,full-name
        ✓ Profile property list

  internal-api/api
    API#createFromSitemap
      ✓ should remap urls to object
      ✓ should capitalize the last segment
      ✓ should capitalize hyphenated last segment

  internal-api/format
    Format#parseDate
      ✓ should throw error for missing date
      ✓ should throw error for invalid date
    Format#date
      ✓ should zero pad days
      ✓ should zero pad months

  internal-api/hash
    Hash#sha512Hash
      ✓ should produce the same hash each time
    Hash#sha512HashCompare
      ✓ should match text with hash
    Hash#bcryptHashHash
      ✓ should hash differently each time
    Hash#bcryptHashCompare
      ✓ should match passwords
      ✓ should not match invalid passwords

  internal-api/html
    HTML#parseHTML
      ✓ should reject invalid strings
      ✓ should return expected contents
    HTML#findOrCreateTableBody
      ✓ should require a document
      ✓ should require a table
      ✓ should accept table ids
      ✓ should return existing TBODY
      ✓ should create new TBODY as last child of table
    HTML#renderTable
      ✓ should require a document
      ✓ should require a table
      ✓ should require a template
      ✓ should require a dataset
      ✓ should create TR for each item
      ✓ should alternate TR class
      ✓ should contain expected data
    HTML#renderList
      ✓ should require a document
      ✓ should require a list
      ✓ should require a template
      ✓ should require a dataset
      ✓ should create LI for each item
      ✓ should contain expected data
    HTML#renderTemplate
      ✓ should require a document
      ✓ should not require a data object
      ✓ should require a template
      ✓ should require a parent element
      ✓ should append contents to parent element
    HTML#renderPagination
      ✓ should require a document
      ✓ should require a total greater than 0
      ✓ should require an offset less than total
      ✓ should accept null or string offset (43ms)
      ✓ should enforce global page size
      ✓ should override global page size

  internal-api/merge-package-json
    MergePackageJSON#loadRootJSON
      Merged content handler order
        ✓ should put application content handler last
        ✓ should put dashboard content handlers first
        ✓ should put module content handlers between dashboard and application
        ✓ should include nested modules
      Merged proxy handler order
        ✓ should put application proxy handlers last
        ✓ should put dashboard proxy handlers first
        ✓ should put module proxy handlers between dashboard and application
        ✓ should include nested modules
      Merged proxy handler order
        ✓ should put application proxy handlers last
        ✓ should put dashboard proxy handlers first
        ✓ should put module proxy handlers between dashboard and application
        ✓ should include nested modules

  internal-api/proxy
    Proxy#pass
      ✓ should include x-accountid header (763ms)
      ✓ should include x-sessionid header (758ms)
      ✓ should include x-dashboard-server header (811ms)
      ✓ should create x-application-server-token header (769ms)
      ✓ should include referer header (758ms)
      ✓ should send POST data (822ms)
      ✓ should send multipart POST data (828ms)
      ✓ should send file upload POST data (830ms)
      ✓ should execute proxy handlers (805ms)

  internal-api/response
    Response#wrapTemplateWithSrcDoc (global setting)
      ✓ should transfer head content from page to template
      ✓ should transfer head content from template to page
      ✓ should transfer navigation to template from page
      ✓ should transfer title to page from template
      ✓ should remove menus for guests
      ✓ should disable administrator menu for normal user (784ms)
      ✓ should add account menu links from package.json (746ms)
      ✓ should add administrator menu links from package.json (761ms)
    Response#wrapTemplateWithSrcDoc (config override)
      ✓ should transfer head content from page to template
      ✓ should transfer head content from template to page
      ✓ should transfer navigation to template from page
      ✓ should transfer title to page from template
      ✓ should remove menus for guests
      ✓ should disable administrator menu for normal user (734ms)
      ✓ should add account menu links from package.json (772ms)
      ✓ should add administrator menu links from package.json (758ms)
      ✓ should execute "page" handlers on the rendered page
      ✓ should execute "template" handlers on the rendered + page-merged template
      ✓ should execute "page" and "template" handlers on the rendered + page-merged template
      ✓ should execute each content handler
    Response#throw404
      ✓ should set 404 status
      ✓ should contain 404 code
      ✓ should contain 404 error
    Response#throw500
      ✓ should set 500 status
      ✓ should contain 500 code
      ✓ should contain error message
    Response#throw511
      ✓ should set 511 status
      ✓ should contain 511 code

  internal-api/server
    Server#authenticateRequest
      ✓ should reject missing token
      ✓ should reject invalid token
      ✓ should identify user from token (803ms)
    Server#parsePostData
      ✓ should ignore file uploads
      ✓ should ignore no-content uploads
      ✓ should parse post data
    Server#receiveRequest
      ✓ should bind query data of URL to req
      ✓ should not bind route for unknown url
      ✓ should bind route to req
      ✓ should redirect user to verification (1472ms)
      ✓ should execute "before" server handler before identifying user (805ms)
      ✓ should execute "after" server handler after identifying user (838ms)
      ✓ should execute "after" server handler after identifying guest
      ✓ should execute "before" and "after" server handler
      ✓ should execute each server handler

  internal-api/sitemap
    Sitemap#authenticateRequest
      ✓ should substitute language HTML file (1037ms)

  internal-api/storage-cache
    get
      ✓ should require key
      ✓ should return value
    set
      ✓ should require key
      ✓ should set value
    remove
      ✓ should require key
      ✓ should remove object

  internal-api/storage-list
    StorageList#add
      ✓ should add string properties (43ms)
      ✓ should add int properties (43ms)
      ✓ should add float properties (42ms)
      ✓ should add boolean properties (42ms)
    StorageList#addMany
      ✓ should add multiple properties (82ms)
      ✓ should skip duplicates (96ms)
    StorageList#count
      ✓ should count the items (3706ms)
      ✓ should not count removed items (4944ms)
    StorageList#remove
      ✓ should remove the item (2488ms)
    StorageList#list
      ✓ should change page size (4963ms)
      ✓ should enforce offset (3731ms)
    StorageList#listAll
      ✓ should return all records (7438ms)

  internal-api/storage-object
    getProperties
      ✓ should return string properties (67ms)
      ✓ should return int properties (59ms)
      ✓ should return float properties (53ms)
      ✓ should return boolean properties (59ms)
    getProperty
      ✓ should return string property (56ms)
      ✓ should return int property (59ms)
      ✓ should return float property (54ms)
      ✓ should return boolean property (54ms)
    removeProperty
      ✓ should delete properties (101ms)
    removeProperties
      ✓ should delete properties (99ms)
    setProperty
      ✓ should set string property (54ms)
      ✓ should set int property (54ms)
      ✓ should set float property (60ms)
      ✓ should set boolean property (55ms)
    setProperties
      ✓ should set string properties (55ms)
      ✓ should set int properties (55ms)
      ✓ should set float properties (54ms)
      ✓ should set boolean properties (60ms)

  internal-api/storage
    Storage#read
      ✓ should require file
      ✓ should return file contents (42ms)
    Storage#readMany
      ✓ should require files array
      ✓ should return files contents (86ms)
    Storage#write
      ✓ should require file
      ✓ should require contents
      ✓ should accept content object (40ms)
      ✓ should accept content string (39ms)
      ✓ should write file contents (40ms)
      ✓ should encrypt contents (69ms)
    Storage#delete
      ✓ should require file
      ✓ should delete file (39ms)

  internal-api/timestamp
    #create
      ✓ should reject null date
      ✓ should accept date
      ✓ should accept string

  internal-api/uuid
    #random
      ✓ should reject null length
    #v4
      ✓ should be a v4 uuid

  /account/change-password
    view
      ✓ should present the form (1382ms)
    submit
      ✓ should apply new password (screenshots) (4655ms)
    errors
      ✓ invalid-new-password (2634ms)
      ✓ invalid-new-password-length (2913ms)
      ✓ invalid-confirm-password (2761ms)
      ✓ invalid-password (2522ms)

  /account/change-username
    view
      ✓ should present the form (1323ms)
    submit
      ✓ should apply new username (screenshots) (4766ms)
    errors
      ✓ invalid-new-username (2713ms)
      ✓ invalid-new-username-length (2288ms)
      ✓ invalid-password (2703ms)

  /account/create-profile
    view
      ✓ should present the form (1319ms)
      ✓ should have elements for full-name (1398ms)
      ✓ should have elements for contact-email (1388ms)
      ✓ should have elements for display-email (1353ms)
      ✓ should have elements for dob (1370ms)
      ✓ should have elements for phone (1344ms)
      ✓ should have elements for occupation (1348ms)
      ✓ should have elements for location (1358ms)
      ✓ should have elements for company-name (1391ms)
      ✓ should have elements for website (1381ms)
    submit
      ✓ should create profile (screenshots) (5823ms)
      ✓ should create profile with full-name (2426ms)
      ✓ should create profile and set default (2513ms)
      ✓ should create profile with display name (2810ms)
      ✓ should create profile with contact-email (2684ms)
      ✓ should create profile with display-email (2765ms)
      ✓ should create profile with dob in YYYY-MM-DD (2367ms)
      ✓ should create profile with dob in MM-DD-YYYY (2482ms)
      ✓ should create profile with phone (2881ms)
      ✓ should create profile with occupation (2892ms)
      ✓ should create profile with location (2831ms)
      ✓ should create profile with company-name (2827ms)
      ✓ should create profile with website (2803ms)
    errors
      ✓ invalid-first-name (1890ms)
      ✓ invalid-first-name-length (3283ms)
      ✓ invalid-last-name (1936ms)
      ✓ invalid-last-name-length (3267ms)
      ✓ invalid-contact-email (3353ms)
      ✓ invalid-display-email (2906ms)
      ✓ invalid-display-name (1709ms)
      ✓ invalid-display-name-length (2959ms)
      ✓ invalid-dob (2963ms)
      ✓ invalid-phone (1734ms)
      ✓ invalid-occupation (1730ms)
      ✓ invalid-location (1698ms)
      ✓ invalid-company-name (1748ms)
      ✓ invalid-website (1802ms)

  /account/create-reset-code
    view
      ✓ should present the form (1329ms)
    submit
      ✓ should create reset code (screenshots) (4025ms)
    errors
      ✓ invalid-secret-code (1827ms)
      ✓ invalid-secret-code-length (2966ms)

  /account/delete-account-complete
    view
      ✓ should present 3 days remaining message (3216ms)
      ✓ should present 7 days remaining message (3708ms)
      ✓ should present instant deletion message (3243ms)
      ✓ should present instant delete message (screenshots) (4352ms)

  /account/delete-account
    view
      ✓ should present the form (2056ms)
    submit
      ✓ should mark account deleted (screenshots) (4425ms)
    errors
      ✓ invalid-password (2652ms)

  /account/delete-profile
    before
      ✓ should bind data (995ms)
    exceptions
      ✓ invalid-profileid (777ms)
      ✓ invalid-profile (779ms)
      ✓ invalid-account (2180ms)
    view
      ✓ should present the form (2035ms)
    submit
      ✓ should delete profile (screenshots) (5750ms)

  /account/delete-reset-code
    before
      ✓ should bind data (970ms)
    exceptions
      ✓ invalid-reset-codeid (741ms)
      ✓ invalid-account (1721ms)
    view
      ✓ should present the form (1555ms)
    submit
      ✓ should delete reset code (screenshots) (4921ms)

  /account/edit-profile
    view
      ✓ should present the form (1340ms)
      ✓ should have elements for full-name (1550ms)
      ✓ should have elements for display-name (1585ms)
      ✓ should have elements for contact-email (1572ms)
      ✓ should have elements for display-email (1521ms)
      ✓ should have elements for dob (1535ms)
      ✓ should have elements for phone (2094ms)
      ✓ should have elements for occupation (1539ms)
      ✓ should have elements for location (1616ms)
      ✓ should have elements for company-name (1536ms)
      ✓ should have elements for website (1566ms)
    submit
      ✓ should update profile (screenshots) (9003ms)
      ✓ should update profile with full-name (2637ms)
      ✓ should update profile with display name (2404ms)
      ✓ should update profile with contact-email (2903ms)
      ✓ should update profile with display-email (2997ms)
      ✓ should update profile with dob in YYYY-MM-DD (2623ms)
      ✓ should update profile with dob in MM-DD-YYYY (2619ms)
      ✓ should update profile with phone (3507ms)
      ✓ should update profile with occupation (3037ms)
      ✓ should update profile with location (3016ms)
      ✓ should update profile with company-name (3046ms)
      ✓ should update profile with website (2996ms)
    errors
      ✓ invalid-first-name (2101ms)
      ✓ invalid-first-name-length (3666ms)
      ✓ invalid-last-name (1961ms)
      ✓ invalid-last-name-length (3342ms)
      ✓ invalid-contact-email (3158ms)
      ✓ invalid-display-email (3177ms)
      ✓ invalid-display-name (1795ms)
      ✓ invalid-display-name-length (3188ms)
      ✓ invalid-dob (3805ms)
      ✓ invalid-phone (2033ms)
      ✓ invalid-occupation (2046ms)
      ✓ invalid-location (2035ms)
      ✓ invalid-company-name (2023ms)
      ✓ invalid-website (2068ms)

  /account/end-all-sessions
    view
      ✓ should present the form (1611ms)
    submit
      ✓ should generate a new session key (screenshots) (3264ms)

  /account/end-session
    before
      ✓ should bind data to req (819ms)
    view
      ✓ should present the form (1377ms)
    submit
      ✓ should end the session (screenshots) (4997ms)
      ✓ should end current session (1889ms)

  /account
    view
      ✓ should return page (screenshots) (2278ms)
      ✓ should not link to account preferences (2314ms)
      ✓ should link to account preferences (2783ms)

  /account/language
    exceptions
      ✓ should require language enabled (764ms)
    view
      ✓ should present the form (1394ms)
    submit
      ✓ should change the language (screenshots) (3553ms)

  /account/profile
    before
      ✓ should bind data to req (787ms)
    view
      ✓ should present the profile table (screenshots) (3731ms)
      ✓ should show fields if data exists (7930ms)

  /account/profiles
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset
      ✓ should show fields if data exists (8798ms)

  /account/register
    view
      ✓ should present the form (419ms)
      ✓ should disable the form (444ms)
      ✓ should have elements for full-name (408ms)
      ✓ should have elements for contact-email (440ms)
      ✓ should have elements for display-email (422ms)
      ✓ should have elements for dob (454ms)
      ✓ should have elements for phone (422ms)
      ✓ should have elements for occupation (426ms)
      ✓ should have elements for location (423ms)
      ✓ should have elements for company-name (433ms)
      ✓ should have elements for website (419ms)
    submit
      ✓ should create new account with full name (7140ms)
      ✓ should create new profile with contact email (7536ms)
      ✓ should create new profile with display email (7978ms)
      ✓ should create new profile with display name (7002ms)
      ✓ should create new profile with dob in YYYY-MM-DD (7224ms)
      ✓ should create new profile with dob in MM-DD-YYYY (7142ms)
      ✓ should create new profile with phone (7551ms)
      ✓ should create new profile with occupation (7659ms)
      ✓ should create new profile with location (7553ms)
      ✓ should create new profile with company-name (7525ms)
      ✓ should create new profile with website (7565ms)
      ✓ should create 20-minute session (7097ms)
      ✓ should create account (screenshots) (9003ms)
    errors
      ✓ invalid-username (5465ms)
      ✓ invalid-username-length (5484ms)
      ✓ invalid-password (5499ms)
      ✓ invalid-password-length (5264ms)
      ✓ invalid-confirm (5554ms)
      ✓ invalid-first-name (6306ms)
      ✓ invalid-first-name-length (12893ms)
      ✓ invalid-last-name (6334ms)
      ✓ invalid-last-name-length (12927ms)
      ✓ invalid-contact-email (12551ms)
      ✓ invalid-display-email (12483ms)
      ✓ invalid-display-name (6112ms)
      ✓ invalid-display-name-length (12651ms)
      ✓ invalid-dob (12715ms)
      ✓ invalid-phone (6393ms)
      ✓ invalid-occupation (6249ms)
      ✓ invalid-location (6153ms)
      ✓ invalid-company-name (6146ms)
      ✓ invalid-website (6172ms)

  /account/reset-account
    view
      ✓ should present the form (649ms)
    submit
      ✓ should reset session key (9429ms)
      ✓ should reset code last used (9363ms)
      ✓ should sign in (screenshots) (12986ms)
    errors
      ✓ invalid-username (5738ms)
      ✓ invalid-secret-code (5656ms)
      ✓ invalid-new-password (5645ms)
      ✓ invalid-new-password-length (5418ms)
      ✓ invalid-confirm-password (5660ms)
      ✓ invalid-account (8006ms)

  /account/reset-code
    before
      ✓ should bind data to req (997ms)
    view
      ✓ should present the reset code table (screenshots) (3363ms)

  /account/reset-codes
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /account/restore-account
    view
      ✓ should present the form (1330ms)
    submit
      ✓ should unset account deleted (screenshots) (12789ms)
    errors
      ✓ invalid-username (6296ms)
      ✓ invalid-password (6196ms)
      ✓ invalid-account (6828ms)

  /account/session
    before
      ✓ should bind data to req (788ms)
    view
      ✓ should present the session table (screenshots) (3140ms)

  /account/sessions
    before
      ✓ should bind data to req
      ✓ should exclude ended sessions (1854ms)
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /account/set-default-profile
    before
      ✓ should bind data to req (1275ms)
    view
      ✓ should present the form (1882ms)
    submit
      ✓ should set the profile as default (screenshots) (6350ms)

  /account/signin
    view
      ✓ should present the form (442ms)
    submit
      ✓ should create session expiring in 20 minutes as default (7941ms)
      ✓ should create session expiring in 20 minutes (8000ms)
      ✓ should create session expiring in 8 hours (14570ms)
      ✓ should create session expiring in 30 days (8083ms)
      ✓ should sign in (screenshots) (9457ms)
    errors
      ✓ invalid-username (4982ms)
      ✓ invalid-password (6522ms)

  /account/signout-complete
    view
      ✓ should sign out (screenshots) (2445ms)

  /account/signout
    view
      ✓ should end the session (2306ms)
      ✓ should redirect to signout complete page (1504ms)
      ✓ should signout (screenshots) (2432ms)

  /account/verify
    view
      ✓ should present the form (1284ms)
    submit
      ✓ should mark session as verified (7665ms)
      ✓ should verify session (screenshots) (12195ms)
    errors
      ✓ invalid-username (5935ms)
      ✓ invalid-password (6668ms)

  /administrator/account-profiles
    before
      ✓ should bind data to req
    view
      ✓ should present the profiles table (screenshots)
      ✓ should return one page
      ✓ should change page size
      ✓ should change offset

  /administrator/account-reset-codes
    before
      ✓ should bind data to req
    view
      ✓ should present the reset codes table (screenshots)
      ✓ should return one page
      ✓ should change page size
      ✓ should change offset

  /administrator/account-sessions
    before
      ✓ should bind data to req
    view
      ✓ should present the sessions table (screenshots)
      ✓ should return one page
      ✓ should change page size
      ✓ should change offset

  /administrator/account
    before
      ✓ should bind data to req (2346ms)
    view
      ✓ should present the account table (screenshots) (3766ms)
      ✓ should present the profile table (2211ms)
      ✓ should present the sessions table (2179ms)
      ✓ should hide empty reset codes table (2440ms)
      ✓ should present a populated reset codes table (2560ms)

  /administrator/accounts
    before
      ✓ should bind data to req
    view
      ✓ should present the accounts table (screenshots)
      ✓ should return one page
      ✓ should change page size
      ✓ should change offset

  /administrator/administrators
    before
      ✓ should bind data to req
    view
      ✓ should present the administrators table (screenshots)
      ✓ should return one page
      ✓ should change page size
      ✓ should change offset

  /administrator/assign-administrator
    before
      ✓ should bind data to req (1471ms)
    view
      ✓ should present the form (2038ms)
    submit
      ✓ should apply account update (screenshots) (5541ms)

  /administrator/create-reset-code
    before
      ✓ should bind data to req (1461ms)
    view
      ✓ should present the form (2047ms)
    submit
      ✓ should create reset code (screenshots) (6535ms)
    errors
      ✓ invalid-secret-code (2576ms)
      ✓ invalid-secret-code-length (3791ms)

  /administrator/delete-account
    exceptions
      ✓ should reject invalid accountid (773ms)
    before
      ✓ should bind data to req (1676ms)
    view
      ✓ should present the form (2248ms)
    submit
      ✓ should immediately delete (screenshots) (5852ms)

  /administrator/delete-schedule
    before
      ✓ should bind data to req (2616ms)
    view
      ✓ should present the deleted accounts table (screenshots) (3547ms)
      ✓ should return one page (4161ms)
      ✓ should change page size (5567ms)
      ✓ should change offset (4134ms)

  /administrator
    view
      ✓ should return page (screenshots) (2231ms)

  /administrator/profile
    before
      ✓ should bind data to req (1502ms)
    view
      ✓ should present the profile table (screenshots) (4253ms)
      ✓ should show fields if data exists (7894ms)

  /administrator/profiles
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset
      ✓ should show fields if data exists (8196ms)

  /administrator/reset-code
    before
      ✓ should bind data to req (1704ms)
    view
      ✓ should present the reset code table (screenshots) (3918ms)

  /administrator/reset-codes
    before
      ✓ should bind data to req
    view
      ✓ should present the reset codes table (screenshots)
      ✓ should return one page
      ✓ should change page size
      ✓ should change offset

  /administrator/reset-session-key
    before
      ✓ should bind data to req (1481ms)
    view
      ✓ should present the form (2581ms)
    submit
      ✓ should reset session key (screenshots) (5607ms)

  /administrator/revoke-administrator
    before
      ✓ should bind data to req (1682ms)
    view
      ✓ should present the form (2248ms)
    submit
      ✓ should revoke administrator status (screenshots) (5744ms)

  /administrator/schedule-account-delete
    before
      ✓ should bind data to req (1494ms)
    view
      ✓ should present the form (2028ms)
    submit
      ✓ should schedule account for deletion (screenshots) (5805ms)

  /administrator/session
    before
      ✓ should bind data to req (1585ms)
    view
      ✓ should present the session table (screenshots) (4377ms)

  /administrator/sessions
    before
      ✓ should bind data to req
    view
      ✓ should present the sessions table (screenshots)
      ✓ should return one page (2901ms)
      ✓ should change page size
      ✓ should change offset

  /administrator/transfer-ownership
    before
      ✓ should bind data to req (1516ms)
    view
      ✓ should present the form (2115ms)
    submit
      ✓ should change ownership (screenshots) (5948ms)

  /api/administrator/account
    exceptions
      invalid-accountid
        ✓ unspecified querystring accountid (820ms)
        ✓ invalid querystring accountid (830ms)
    returns
      ✓ object (2046ms)
    redacts
      ✓ usernameHash (1573ms)
      ✓ passwordHash (1555ms)
      ✓ sessionKey (1613ms)

  /api/administrator/accounts-count
    returns
      ✓ integer (3009ms)

  /api/administrator/accounts
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    redacts
      ✓ usernameHash
      ✓ passwordHash
      ✓ sessionKey
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/administrator-accounts-count
    returns
      ✓ integer (1748ms)

  /api/administrator/administrator-accounts
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    redacts
      ✓ usernameHash
      ✓ passwordHash
      ✓ sessionKey
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/create-reset-code
    exceptions
      invalid-accountid
        ✓ unspecified querystring accountid (802ms)
        ✓ invalid querystring accountid (801ms)
      invalid-secret-code
        ✓ missing posted secret-code (1547ms)
      invalid-secret-code-length
        ✓ invalid posted secret-code length (1600ms)
    returns
      ✓ object (1691ms)
    configuration
      ✓ environment MINIMUM_RESET_CODE_LENGTH (1539ms)
      ✓ environment MAXIMUM_RESET_CODE_LENGTH (1542ms)

  /api/administrator/delete-account
    exceptions
      invalid-accountid
        ✓ missing querystring accountid (803ms)
        ✓ invalid querystring accountid (812ms)
    receieves
      ✓ querystring accountid (1840ms)
    returns
      ✓ boolean (1834ms)

  /api/administrator/deleted-accounts-count
    returns
      ✓ querystring accountid (4022ms)

  /api/administrator/deleted-accounts
    receives
      ✓ optional querystring offset (integer) (3550ms)
      ✓ optional querystring limit (integer) (2702ms)
      ✓ optional querystring all (boolean) (3512ms)
    returns
      ✓ array (2649ms)
    redacts
      ✓ usernameHash (2251ms)
      ✓ passwordHash (1753ms)
      ✓ sessionKey (1757ms)
    configuration
      ✓ environment PAGE_SIZE (4838ms)

  /api/administrator/profile
    exceptions
      invalid-profileid
        ✓ missing querystring profileid (863ms)
        ✓ invalid querystring profileid (796ms)
    returns
      ✓ object (1634ms)

  /api/administrator/profiles-count
    returns
      ✓ integer (2920ms)

  /api/administrator/profiles
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
      ✓ optional querystring accountid (string)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/reset-account-administrator
    exceptions
      invalid-accountid
        ✓ missing querystring accountid (789ms)
        ✓ invalid querystring accountid (806ms)
      invalid-account
        ✓ accessing account is not owner (1555ms)
        ✓ querystring accountid is not administrator (1518ms)
    returns
      ✓ object (1837ms)

  /api/administrator/reset-code
    exceptions
      invalid-reset-codeid
        ✓ missing querystring codeid (812ms)
        ✓ invalid querystring codeid (842ms)
    returns
      ✓ object (1752ms)
    redacts
      ✓ secretCodeHash (1731ms)

  /api/administrator/reset-codes-count
    returns
      ✓ integer (3596ms)

  /api/administrator/reset-codes
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
      ✓ optional querystring accountid (string)
    returns
      ✓ array
    redacts
      ✓ secretCodeHash
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/reset-session-key
    exceptions
      invalid-accountid
        ✓ missing querystring accountid (799ms)
        ✓ invalid querystring accountid (853ms)
    invalid-account
      ✓ ineligible querystring account is deleted (1692ms)
    requires
      ✓ querystring accountid is not deleted (1727ms)
    returns
      ✓ object (1693ms)

  /api/administrator/session
    exceptions
      invalid-sessionid
        ✓ unspecified querystring accountid (795ms)
        ✓ invalid querystring sessionid (832ms)
    returns
      ✓ object (1576ms)
    redacts
      ✓ tokenHash (1712ms)

  /api/administrator/sessions-count
    returns
      ✓ integer (3542ms)

  /api/administrator/sessions
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
      ✓ optional querystring accountid (string)
    returns
      ✓ array
    redacts
      ✓ tokenHash
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/set-account-administrator
    exceptions
      invalid-accountid
        ✓ unspecified querystring accountid (804ms)
        ✓ invalid querystring accountid (837ms)
      invalid-account
        ✓ ineligible querystring account is already administrator (840ms)
    requires
      ✓ querystring accountid is not administrator (825ms)
    returns
      ✓ object (1676ms)

  /api/administrator/set-account-deleted
    exceptions
      invalid-accountid
        ✓ unspecified querystring accountid (772ms)
        ✓ invalid querystring accountid (824ms)
      invalid-account
        ✓ ineligible querystring account is already deleted (1747ms)
    invalid-account
      ✓ querystring accountid is deleted (1750ms)
    returns
      ✓ object (2206ms)
    configuration
      ✓ environment DELETE_DELAY (1620ms)

  /api/administrator/set-owner-account
    exceptions
      invalid-accountid
        ✓ missing querystring accountid (793ms)
        ✓ invalid querystring accountid (776ms)
      invalid-account
        ✓ ineligible accessing account (2438ms)
        ✓ ineligible querystring account is already owner (836ms)
    requires
      ✓ accessing account is owner (2382ms)
      ✓ querystring account is not owner (781ms)
      ✓ querystring account is not deleted (1717ms)
    returns
      ✓ object (1729ms)

  /api/user/account
    exceptions
      invalid-accountid
        ✓ missing querystring accountid (790ms)
        ✓ invalid querystring accountid (823ms)
      invalid-account
        ✓ ineligible accessing account (2107ms)
    returns
      ✓ object (814ms)
    redacts
      ✓ usernameHash (794ms)
      ✓ passwordHash (840ms)
      ✓ sessionKey (822ms)

  /api/user/create-account
    exceptions
      invalid-username
        ✓ missing posted username
      invalid-username-length
        ✓ posted username too short
        ✓ posted username too long
      invalid-password
        ✓ missing posted password
      invalid-password-length
        ✓ posted password too short
        ✓ posted password too long
      invalid-first-name
        ✓ missing posted first-name
      invalid-first-name-length
        ✓ posted first-name too short
        ✓ posted first-name too long
      invalid-last-name
        ✓ missing posted last-name
      invalid-last-name-length
        ✓ posted last-name too short
        ✓ posted last-name too long
      invalid-display-name
        ✓ missing posted display-name
      invalid-display-name-length
        ✓ posted display-name too short
        ✓ posted display-name too long
      invalid-company-name
        ✓ missing posted company-name
      invalid-contact-email
        ✓ missing posted contact-email
      invalid-display-email
        ✓ missing posted display-email
      invalid-location
        ✓ missing posted location
      invalid-occupation
        ✓ missing posted occupation
      invalid-phone
        ✓ missing posted phone
      invalid-dob
        ✓ missing posted dob
    receives
      ✓ optionally-required posted first-name (240ms)
      ✓ optionally-required posted last-name (245ms)
      ✓ optionally-required posted display-name (246ms)
      ✓ optionally-required posted company-name (245ms)
      ✓ optionally-required posted contact-email (249ms)
      ✓ optionally-required posted display-email (249ms)
      ✓ optionally-required posted location (241ms)
      ✓ optionally-required posted occupation (246ms)
      ✓ optionally-required posted phone (239ms)
      ✓ optionally-required posted dob (240ms)
    returns
      ✓ object (102ms)
    configuration
      ✓ environment MINIMUM_USERNAME_LENGTH
      ✓ environment MAXIMUM_USERNAME_LENGTH
      ✓ environment MINIMUM_PASSWORD_LENGTH
      ✓ environment MAXIMUM_PASSWORD_LENGTH
      ✓ environment REQUIRE_PROFILE
      ✓ environment USER_PROFILE_FIELDS (2244ms)
      ✓ environment MINIMUM_PROFILE_FIRST_NAME_LENGTH
      ✓ environment MAXIMUM_PROFILE_FIRST_NAME_LENGTH
      ✓ environment MINIMUM_PROFILE_LAST_NAME_LENGTH
      ✓ environment MAXIMUM_PROFILE_LAST_NAME_LENGTH
      ✓ environment MINIMUM_PROFILE_DISPLAY_NAME_LENGTH
      ✓ environment MAXIMUM_PROFILE_DISPLAY_NAME_LENGTH
      ✓ environment MINIMUM_PROFILE_COMPANY_NAME_LENGTH (138ms)
      ✓ environment MAXIMUM_PROFILE_COMPANY_NAME_LENGTH (130ms)
      ✓ override req.userProfileFields (2173ms)

  /api/user/create-profile
    exceptions
      invalid-accountid
        ✓ missing querystring accountid (784ms)
        ✓ invalid querystring accountid (817ms)
      invalid-accountid
        ✓ ineligible accessing account (1600ms)
      invalid-first-name
        ✓ missing posted first-name (815ms)
      invalid-first-name-length
        ✓ posted first-name too short (1402ms)
        ✓ posted first-name too long (838ms)
      invalid-last-name
        ✓ missing posted last-name (810ms)
      invalid-last-name-length
        ✓ posted last-name too short (877ms)
        ✓ posted last-name too long (816ms)
      invalid-display-name
        ✓ missing posted display-name (811ms)
      invalid-display-name-length
        ✓ posted display-name too short (841ms)
        ✓ posted display-name too long (848ms)
      invalid-company-name-length
        ✓ posted company-name too short (819ms)
        ✓ posted company-name too long (822ms)
      invalid-company-name-length
        ✓ invalid-company-name-length (834ms)
      invalid-contact-email
        ✓ missing posted contact-email (831ms)
      invalid-display-email
        ✓ missing posted display-email (851ms)
      invalid-location
        ✓ missing posted location (839ms)
      invalid-occupation
        ✓ missing posted occupation (866ms)
      invalid-phone
        ✓ missing posted phone (838ms)
      invalid-dob
        ✓ missing posted dob (878ms)
    receives
      ✓ optionally-required posted first-name (930ms)
      ✓ optionally-required posted last-name (990ms)
      ✓ optionally-required posted display-name (1058ms)
      ✓ optionally-required posted company-name (1581ms)
      ✓ optionally-required posted contact-email (996ms)
      ✓ optionally-required posted display-email (1029ms)
      ✓ optionally-required posted location (974ms)
      ✓ optionally-required posted occupation (926ms)
      ✓ optionally-required posted phone (938ms)
      ✓ optionally-required posted dob (980ms)
    returns
      ✓ object (1006ms)
    configuration
      ✓ environment USER_PROFILE_FIELDS (2744ms)
      ✓ environment MINIMUM_PROFILE_FIRST_NAME_LENGTH (815ms)
      ✓ environment MAXIMUM_PROFILE_FIRST_NAME_LENGTH (833ms)
      ✓ environment MINIMUM_PROFILE_LAST_NAME_LENGTH (844ms)
      ✓ environment MAXIMUM_PROFILE_LAST_NAME_LENGTH (875ms)
      ✓ environment MINIMUM_PROFILE_DISPLAY_NAME_LENGTH (794ms)
      ✓ environment MAXIMUM_PROFILE_DISPLAY_NAME_LENGTH (823ms)
      ✓ environment MINIMUM_PROFILE_COMPANY_NAME_LENGTH (828ms)
      ✓ environment MAXIMUM_PROFILE_COMPANY_NAME_LENGTH (852ms)
      ✓ override req.userProfileFields (2730ms)

  /api/user/create-reset-code
    exceptions
      invalid-accountid
        ✓ missing querystring accountid (810ms)
        ✓ invalid querystring accountid (797ms)
      invalid-accountid
        ✓ ineligible accessing account (1650ms)
      invalid-secret-code
        ✓ missing posted secret-code (814ms)
      invalid-secret-code-length
        ✓ posted secret code too short (816ms)
        ✓ posted secret code too long (811ms)
    returns
      ✓ object (987ms)

  /api/user/create-session
    exceptions
      invalid-username
        ✓ missing posted username
      invalid-password
        ✓ missing posted password
    receives
      ✓ optional posted remember (hours|days) (1299ms)
    returns
      ✓ object (955ms)

  /api/user/delete-profile
    exceptions
      invalid-profileid
        ✓ missing querystring profileid (811ms)
        ✓ invalid querystring profileid (791ms)
      invalid-profile
        ✓ querystring profileid is default contact profile (805ms)
      invalid-account
        ✓ ineligible querystring profileid (1662ms)
    returns
      ✓ boolean (1206ms)

  /api/user/delete-reset-code
    exceptions
      invalid-reset-codeid
        ✓ missing querystring codeid (869ms)
        ✓ invalid querystring codeid (1408ms)
      invalid-account
        ✓ ineligible querystring codeid (1763ms)
    returns
      ✓ boolean (1147ms)

  /api/user/profile
    exceptions
      invalid-profileid
        ✓ missing querystring profileid (796ms)
        ✓ invalid querystring profileid (810ms)
      invalid-account
        ✓ ineligible querystring profileid (1559ms)
    returns
      ✓ object (813ms)

  /api/user/profiles-count
    exceptions
      invalid-accountid
        ✓ missing querystring accountid (796ms)
        ✓ invalid querystring accountid (791ms)
      invalid-account
        ✓ ineligible accessing account (1556ms)
    returns
      ✓ integer (1446ms)

  /api/user/profiles
    exceptions
      invalid-accountid
        ✓ missing querystring accountid (802ms)
        ✓ invalid querystring accountid (813ms)
      invalid-account
        ✓ ineligible accessing account (2170ms)
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/reset-account-deleted
    exceptions
      invalid-username
        ✓ missing posted username (899ms)
        ✓ invalid posted username (951ms)
      invalid-password
        ✓ missing posted password (927ms)
        ✓ invalid posted password (988ms)
      invalid-account
        ✓ credentialed account is not scheduled for deletion (890ms)
    returns
      ✓ object (1114ms)

  /api/user/reset-account-password
    exceptions
      invalid-username
        ✓ missing posted username
        ✓ invalid posted username
      invalid-password
        ✓ missing posted new-password
      invalid-secret-code
        ✓ missing posted secret-code
      invalid-reset-code
        ✓ invalid posted secret-code (822ms)
    returns
      ✓ boolean (1172ms)

  /api/user/reset-code
    exceptions
      invalid-reset-codeid
        ✓ missing querystring codeid (817ms)
        ✓ invalid querystring codeid (810ms)
      invalid-account
        ✓ ineligible querystring codeid (1736ms)
    returns
      ✓ object (1042ms)
    redacts
      ✓ secretCodeHash (1015ms)

  /api/user/reset-codes-count
    exceptions
      invalid-accountid
        ✓ missing querystring accountid (825ms)
        ✓ invalid querystring accountid (809ms)
      invalid-account
        ✓ ineligible accessing account (1592ms)
    returns
      ✓ integer (2056ms)

  /api/user/reset-codes
    exceptions
      invalid-accountid
        ✓ missing querystring accountid (783ms)
        ✓ invalid querystring accountid (830ms)
      invalid-account
        ✓ ineligible accessing account (1548ms)
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    redacts
      ✓ secretCodeHash
    configuration
      ✓ environment PAGE_SIZE

  /api/user/reset-session-key
    exceptions
      invalid-accountid
        ✓ missing querystring accountid (800ms)
        ✓ invalid querystring accountid (904ms)
      invalid-account
        ✓ ineligible accessing account (1559ms)
    returns
      ✓ boolean (993ms)

  /api/user/session
    exceptions
      invalid-sessionid
        ✓ missing querystring sessionid (769ms)
        ✓ invalid querystring sessionid (815ms)
      invalid-account
        ✓ ineligible querystring sessionid (1542ms)
    returns
      ✓ object (828ms)
    redacts
      ✓ tokenHash (841ms)

  /api/user/sessions-count
    exceptions
      invalid-accountid
        ✓ missing querystring accountid (802ms)
        ✓ invalid querystring accountid (1372ms)
      invalid-account
        ✓ ineligible accessing account (1545ms)
    returns
      ✓ integer (1550ms)

  /api/user/sessions
    exceptions
      invalid-accountid
        ✓ missing querystring accountid (796ms)
        ✓ invalid querystring accountid (862ms)
      invalid-account
        ✓ ineligible accessing account (1555ms)
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/set-account-deleted
    exceptions
      invalid-accountid
        ✓ missing querystring accountid (770ms)
        ✓ invalid querystring accountid (793ms)
      invalid-account
        ✓ ineligible accessing account (1587ms)
      invalid-password
        ✓ missing posted password (810ms)
        ✓ invalid posted password (892ms)
    returns
      ✓ object (918ms)
    configuration
      ✓ environment DELETE_DELAY (924ms)

  /api/user/set-account-language
    exceptions
      invalid-accountid
        ✓ missing querystring accountid (775ms)
        ✓ invalid querystring accountid (785ms)
      invalid-account
        ✓ ineligible accessing account (2106ms)
      invalid-language
        ✓ missing posted language (834ms)
        ✓ invalid posted language (832ms)
    receives
      ✓ required posted language (861ms)
    returns
      ✓ object (888ms)

  /api/user/set-account-password
    exceptions
      invalid-accountid
        ✓ missing querystring accountid (824ms)
        ✓ invalid querystring accountid (802ms)
      invalid-account
        ✓ ineligible accessing account (1549ms)
      invalid-password
        ✓ missing posted password (842ms)
        ✓ invalid posted password (843ms)
      invalid-new-password
        ✓ missing posted new-password (850ms)
      invalid-new-password-length
        ✓ posted new-password too short (873ms)
        ✓ posted new-password too long (928ms)
    returns
      ✓ object (1072ms)

  /api/user/set-account-profile
    exceptions
      invalid-accountid
        ✓ missing querystring accountid (888ms)
        ✓ invalid querystring accountid (946ms)
      invalid-account
        ✓ ineligible accessing account (1620ms)
      invalid-profileid
        ✓ missing posted profileid (817ms)
        ✓ invalid posted profileid (1474ms)
    returns
      ✓ object (1169ms)

  /api/user/set-account-username
    exceptions
      invalid-accountid
        ✓ missing querystring accountid (815ms)
        ✓ invalid querystring accountid (846ms)
      invalid-account
        ✓ ineligible accessing account (1490ms)
      invalid-password
        ✓ missing posted password (822ms)
        ✓ invalid posted password (881ms)
      invalid-new-username
        ✓ missing posted new-username (873ms)
      invalid-new-username-length
        ✓ posted new-username too short (830ms)
        ✓ posted new-username too long (838ms)
    returns
      ✓ object (995ms)

  /api/user/set-session-ended
    exceptions
      invalid-sessionid
        ✓ missing querystring sessionid (789ms)
        ✓ invalid querystring sessionid (868ms)
      invalid-session
        ✓ querystring sessionid is not active session (1255ms)
      invalid-account
        ✓ ineligible querystring sessionid (1536ms)
    returns
      ✓ object (909ms)

  /api/user/set-session-verified
    exceptions
      invalid-sessionid
        ✓ missing querystring sessionid (823ms)
        ✓ invalid querystring sessionid (835ms)
      invalid-account
        ✓ ineligible querystring sessionid (2158ms)
    returns
      ✓ object (1022ms)

  /api/user/update-profile
    exceptions
      invalid-profileid
        ✓ missing querystring profileid (868ms)
        ✓ invalid querystring profileid (884ms)
      invalid-profileid
        ✓ ineligible querystring profileid (1619ms)
      invalid-first-name
        ✓ missing posted first-name (897ms)
      invalid-first-name-length
        ✓ posted first-name too short (866ms)
        ✓ posted first-name too long (883ms)
      invalid-last-name
        ✓ missing posted last-name (834ms)
      invalid-last-name-length
        ✓ posted last-name too short (829ms)
        ✓ posted last-name too long (833ms)
      invalid-display-name
        ✓ missing posted display-name (819ms)
      invalid-display-name-length
        ✓ posted display-name too short (818ms)
        ✓ posted display-name too long (853ms)
      invalid-company-name
        ✓ missing posted company-name (825ms)
      invalid-company-name-length
        ✓ posted company-name too short (817ms)
        ✓ posted company-name too long (835ms)
      invalid-contact-email
        ✓ missing posted contact-email (811ms)
      invalid-display-email
        ✓ missing posted display-email (851ms)
      invalid-location
        ✓ missing posted location (1420ms)
      invalid-occupation
        ✓ missing posted occupation (806ms)
      invalid-phone
        ✓ missing posted phone (834ms)
      invalid-dob
        ✓ missing posted dob (858ms)
    receives
      ✓ optionally-required posted first-name (897ms)
      ✓ optionally-required posted last-name (931ms)
      ✓ optionally-required posted display-name (889ms)
      ✓ optionally-required posted company-name (918ms)
      ✓ optionally-required posted contact-email (919ms)
      ✓ optionally-required posted display-email (907ms)
      ✓ optionally-required posted location (949ms)
      ✓ optionally-required posted occupation (897ms)
      ✓ optionally-required posted phone (920ms)
      ✓ optionally-required posted dob (907ms)
    returns
      ✓ object (934ms)
    configuration
      ✓ environment USER_PROFILE_FIELDS (2627ms)
      ✓ environment MINIMUM_PROFILE_FIRST_NAME_LENGTH (971ms)
      ✓ environment MAXIMUM_PROFILE_FIRST_NAME_LENGTH (926ms)
      ✓ environment MINIMUM_PROFILE_LAST_NAME_LENGTH (1440ms)
      ✓ environment MAXIMUM_PROFILE_LAST_NAME_LENGTH (843ms)
      ✓ environment MINIMUM_PROFILE_DISPLAY_NAME_LENGTH (840ms)
      ✓ environment MAXIMUM_PROFILE_DISPLAY_NAME_LENGTH (816ms)
      ✓ environment MINIMUM_PROFILE_COMPANY_NAME_LENGTH (843ms)
      ✓ environment MAXIMUM_PROFILE_COMPANY_NAME_LENGTH (855ms)
      ✓ override req.userProfileFields (1907ms)

  index
    MINIMUM_ORGANIZATION_NAME_LENGTH
      Shortest organization name length
        ✓ default 1
        ✓ Integer
    MAXIMUM_ORGANIZATION_NAME_LENGTH
      Longest organization name length
        ✓ default 50
        ✓ Integer
    MINIMUM_INVITATION_CODE_LENGTH
      Shortest invitation code length
        ✓ default 6
        ✓ Integer
    MAXIMUM_INVITATION_CODE_LENGTH
      Longest invitation code length
        ✓ default 50
        ✓ Integer
    MEMBERSHIP_PROFILE_FIELDS
      Personal information to share with members
        ✓ default display-name,display-email
        ✓ Profile property list

  /account/organizations/accept-invitation
    view
      ✓ should present the form (1364ms)
      ✓ should exclude invalid profiles (2868ms)
    submit
      ✓ should accept valid existing profile (5505ms)
      ✓ should accept invitation and create profile (screenshots) (8022ms)
    errors
      ✓ invalid-account (8601ms)

  /account/organizations/create-invitation
    exceptions
      ✓ invalid-account (2885ms)
    before
      ✓ should bind data to req (1365ms)
    view
      ✓ should present the form (1960ms)
    submit
      ✓ should create invitation (screenshots) (6826ms)

  /account/organizations/create-organization
    view
      ✓ should present the form (1367ms)
    submit
      ✓ should accept valid existing profile (3040ms)
      ✓ should create organization (screenshots) (4874ms)
    errors
      ✓ invalid-organization-name (2238ms)
      ✓ invalid-organization-name-length (4764ms)
      ✓ invalid-organization-email (3448ms)

  /account/organizations/delete-invitation
    exceptions
      ✓ invalid-account (2298ms)
    before
      ✓ should bind data (1530ms)
    view
      ✓ should present the form (2180ms)
    submit
      ✓ should delete invitation (screenshots) (6886ms)

  /account/organizations/delete-membership
    exceptions
      ✓ invalid-account (3761ms)
    before
      ✓ should bind data to req (2893ms)
    view
      ✓ should present the form (4156ms)
    submit
      ✓ should delete membership (screenshots) (7948ms)

  /account/organizations/delete-organization
    exceptions
      ✓ invalid-account (2913ms)
    before
      ✓ should bind data to req (1350ms)
    view
      ✓ should present the form (1980ms)
    submit
      ✓ should delete organization (screenshots) (6207ms)

  /account/organizations/edit-membership-profile
    view
      ✓ should present the form (3566ms)
      ✓ should have elements for full-name (4434ms)
      ✓ should have elements for display-name (3553ms)
      ✓ should have elements for contact-email (3538ms)
      ✓ should have elements for display-email (3573ms)
      ✓ should have elements for dob (3499ms)
      ✓ should have elements for phone (3597ms)
      ✓ should have elements for occupation (4117ms)
      ✓ should have elements for location (3679ms)
      ✓ should have elements for company-name (3635ms)
      ✓ should have elements for website (3597ms)
    submit
      ✓ should update profile (screenshots) (11074ms)
      ✓ should update profile with full-name (4925ms)
      ✓ should update profile with display name (5395ms)
      ✓ should update profile with contact-email (5274ms)
      ✓ should update profile with display-email (5340ms)
      ✓ should update profile with dob in YYYY-MM-DD (4854ms)
      ✓ should update profile with dob in MM-DD-YYYY (4796ms)
      ✓ should update profile with phone (5886ms)
      ✓ should update profile with occupation (5349ms)
      ✓ should update profile with location (5350ms)
      ✓ should update profile with company-name (5448ms)
      ✓ should update profile with website (5213ms)
    errors
      ✓ invalid-first-name (4789ms)
      ✓ invalid-first-name-length (5921ms)
      ✓ invalid-last-name (4237ms)
      ✓ invalid-last-name-length (5907ms)
      ✓ invalid-contact-email (5566ms)
      ✓ invalid-display-email (6029ms)
      ✓ invalid-display-name (4107ms)
      ✓ invalid-display-name-length (5646ms)
      ✓ invalid-dob (5576ms)
      ✓ invalid-phone (4229ms)
      ✓ invalid-occupation (4713ms)
      ✓ invalid-location (4117ms)
      ✓ invalid-company-name (4040ms)
      ✓ invalid-website (4197ms)

  /account/organizations/edit-organization
    exceptions
      ✓ should require owner (2178ms)
    before
      ✓ should bind data to req (1355ms)
    view
      ✓ should present the form (1885ms)
    submit
      ✓ should apply organization update (screenshots) (7183ms)
    errors
      ✓ invalid-organization-name (3545ms)
      ✓ invalid-organization-name-length (3804ms)
      ✓ invalid-organization-email (2594ms)

  /account/organizations/index
    before
      ✓ should bind data to req (3066ms)
    view
      ✓ should have row for each organization (2094ms)
      ✓ should have row for each membership (screenshots) (4628ms)

  /account/organizations/invitation
    before
      ✓ should require owner (2305ms)
      ✓ should bind data to req (1567ms)
    view
      ✓ should have row for invitation (screenshots) (6292ms)

  /account/organizations/membership
    before
      ✓ should reject non-member (4271ms)
      ✓ should bind data to req (2966ms)
    view
      ✓ should have row for membership (screenshots) (5857ms)
      ✓ should show profile fields if data exists (14306ms)

  /account/organizations/memberships
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset
      ✓ should show profile fields if data exists (24874ms)

  /account/organizations/organization-invitations
    before
      ✓ should require owner (2313ms)
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /account/organizations/organization-memberships
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /account/organizations/organization
    before
      ✓ should reject non-member (2042ms)
      ✓ should bind data to req (2833ms)
    view
      ✓ should have row for organization (screenshots) (5992ms)

  /account/organizations/organizations
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /account/organizations/revoke-membership
    exceptions
      ✓ invalid-account (3027ms)
    before
      ✓ should bind data to req (2992ms)
    view
      ✓ should present the form (3708ms)
    submit
      ✓ should delete membership (screenshots) (10210ms)

  /account/organizations/transfer-organization
    exceptions
      ✓ invalid-account (3127ms)
    before
      ✓ should bind data to req (3116ms)
    view
      ✓ should present the form (3750ms)
    submit
      ✓ should transfer ownership (screenshots) (8457ms)

  /administrator/organizations/index
    before
      ✓ should bind data to req (5915ms)
    view
      ✓ should have row for each organization (screenshots) (3668ms)
      ✓ should have organization row for each membership (4308ms)

  /administrator/organizations/invitation
    before
      ✓ should bind data to req (2324ms)
    view
      ✓ should have row for invitation (screenshots) (5298ms)

  /administrator/organizations/invitations
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/organizations/membership
    before
      ✓ should bind data to req (4305ms)
    view
      ✓ should have row for membership (screenshots) (6879ms)

  /administrator/organizations/memberships
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset
      ✓ should show profile fields if data exists (30859ms)

  /administrator/organizations/organization-invitations
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/organizations/organization-memberships
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /administrator/organizations/organization
    before
      ✓ should bind data to req (4201ms)
    view
      ✓ should have row for organization (screenshots) (5577ms)

  /administrator/organizations/organizations
    before
      ✓ should bind data to req
    view
      ✓ should return one page (screenshots)
      ✓ should change page size
      ✓ should change offset

  /api/administrator/organizations/invitation
    exceptions
      invalid-invitationid
        ✓ missing querystring invitationid (827ms)
        ✓ invalid querystring invitationid (823ms)
    returns
      ✓ object (2288ms)
    redacts
      ✓ secretCodeHash (2441ms)

  /api/administrator/organizations/invitations-count
    returns
      ✓ integer (5931ms)

  /api/administrator/organizations/invitations
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
      ✓ optional querystring accountid (string)
      ✓ optional querystring organizationid (string)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/organizations/membership
    exceptions
      invalid-membershipid
        ✓ missing querystring membershipid (807ms)
        ✓ invalid querystring membershipid (840ms)
    returns
      ✓ object (3670ms)

  /api/administrator/organizations/memberships-count
    returns
      ✓ integer (8119ms)

  /api/administrator/organizations/memberships
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
      ✓ optional querystring accountid (string)
      ✓ optional querystring organizationid (string)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/administrator/organizations/organization
    exceptions
      invalid-organizationid
        ✓ unspecified querystring organizationid (813ms)
        ✓ invalid querystring organizationid (775ms)
    returns
      ✓ object (2803ms)

  /api/administrator/organizations/organizations-count
    returns
      ✓ integer (4634ms)

  /api/administrator/organizations/organizations
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
      ✓ optional querystring accountid (string)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/organizations/create-invitation
    exceptions
      invalid-organizationid
        ✓ missing querystring organizationid (871ms)
        ✓ invalid querystring organizationid (917ms)
      invalid-secret-code
        ✓ missing posted secret-code (1385ms)
      invalid-secret-code-length
        ✓ posted secret-code too short (1373ms)
        ✓ posted secret-code too long (1350ms)
      invalid-account
        ✓ accessing account is not organization owner (2724ms)
    receives
      ✓ required posted secret-code (1546ms)
    returns
      ✓ object (1518ms)

  /api/user/organizations/create-membership
    exceptions
      invalid-invitationid
        ✓ missing querystring invitationid (821ms)
        ✓ invalid querystring invitationid (831ms)
      invalid-invitation
        ✓ querystring invitationid has been used (3814ms)
        ✓ posted secret-code has been used (3754ms)
      invalid-secret-code
        ✓ missing posted secret-code (2240ms)
        ✓ invalid posted secret-code (2419ms)
      invalid-account
        ✓ accessing account is organization owner (2277ms)
        ✓ accessing account is organization member (3382ms)
      invalid-profileid
        ✓ missing posted profileid (2365ms)
        ✓ invalid posted profileid (2447ms)
      invalid-profile
        ✓ ineligible posted profileid is missing fields (2559ms)
      invalid-invitation
        ✓ querystring invitationid is not open invitation (3794ms)
    receives
      ✓ required posted secret-code (2952ms)
      ✓ required posted profileid (3446ms)
    returns
      ✓ object (2875ms)

  /api/user/organizations/create-organization
    exceptions
      invalid-organization-name
        ✓ missing posted name (930ms)
    invalid-organization-name-length
      ✓ posted name too short (1086ms)
      ✓ posted name too long (1138ms)
    invalid-organization-email
      ✓ missing posted email (1026ms)
      ✓ invalid posted email (966ms)
    invalid-profile
      ✓ missing posted profileid (869ms)
      ✓ invalid posted profileid (822ms)
      ✓ ineligible posted profileid missing fields (1011ms)
    receives
      ✓ required posted organization-email (1171ms)
      ✓ required posted organization-name (1151ms)
      ✓ required posted profileid (1313ms)
    returns
      ✓ object (1175ms)

  /api/user/organizations/delete-invitation
    exceptions
      invalid-invitationid
        ✓ missing querystring invitationid (799ms)
        ✓ invalid querystring invitationid (828ms)
      invalid-invitation
        ✓ querystring invitationid is used invitation (3575ms)
      invalid-account
        ✓ accessing account is not organization owner (2354ms)
    returns
      ✓ boolean (1782ms)

  /api/user/organizations/delete-membership
    exceptions
      invalid-membershipid
        ✓ missing querystring membershipid (799ms)
        ✓ invalid querystring membershipid (789ms)
      invalid-account
        ✓ accessing account is not membership or organization owner (3697ms)
    returns
      ✓ boolean (3098ms)

  /api/user/organizations/delete-organization
    exceptions
      invalid-organizationid
        ✓ missing querystring organizationid (784ms)
        ✓ invalid querystring organizationid (817ms)
      invalid-account
        ✓ accessing account does not own organization (2780ms)
    returns
      ✓ boolean (1642ms)

  /api/user/organizations/invitation
    exceptions
      invalid-invitationid
        ✓ missing querystring invitationid (848ms)
        ✓ invalid querystring invitationid (1607ms)
      invalid-account
        ✓ accessing account is not organization owner (3133ms)
    returns
      ✓ object (1590ms)
    redacts
      ✓ secretCodeHash (1622ms)

  /api/user/organizations/invitations-count
    exceptions
      invalid-accountid
        ✓ missing querystring accountid (830ms)
        ✓ invalid querystring accountid (837ms)
      invalid-account
        ✓ ineligible accessing account (3173ms)
    returns
      ✓ integer (2022ms)

  /api/user/organizations/invitations
    exceptions
      invalid-accountid
        ✓ missing querystring accountid (1428ms)
        ✓ invalid querystring accountid (800ms)
      invalid-account
        ✓ ineligible accessing account (3218ms)
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
      ✓ optional querystring organizationid (string)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/organizations/membership
    exceptions
      invalid-membershipid
        ✓ missing querystring membershipid (898ms)
        ✓ invalid querystring membershipid (892ms)
      invalid-account
        ✓ accessing account must be organization member or owner (3915ms)
    returns
      ✓ object (3004ms)

  /api/user/organizations/memberships-count
    exceptions
      invalid-accountid
        ✓ missing querystring accountid (801ms)
        ✓ invalid querystring accountid (791ms)
      invalid-account
        ✓ ineligible accessing account (3095ms)
    returns
      ✓ integer (7597ms)

  /api/user/organizations/memberships
    exceptions
      invalid-accountid
        ✓ missing querystring accountid (788ms)
        ✓ invalid querystring accountid (917ms)
      invalid-account
        ✓ ineligible accessing account (3805ms)
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
      ✓ optional querystring organizationid (string)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/organizations/invitation
    exceptions
      invalid-invitationid
        ✓ missing querystring invitationid (838ms)
        ✓ invalid querystring invitationid (796ms)
      invalid-invitation
        ✓ querystring invitationid is used (3211ms)
    returns
      ✓ object (1665ms)

  /api/user/organizations/open-invitation
    exceptions
      invalid-invitationid
        ✓ missing querystring invitationid (882ms)
        ✓ invalid querystring invitationid (849ms)
      invalid-invitation
        ✓ querystring invitationid is used (3312ms)
    returns
      ✓ object (2385ms)
    redacts
      ✓ secretCodeHash (2306ms)

  /api/user/organizations/organization-membership
    exceptions
      invalid-organizationid
        ✓ missing querystring organizationid (794ms)
        ✓ invalid querystring organizationid (816ms)
      invalid-account
        ✓ accessing account must be organization member (4295ms)
    returns
      ✓ object (3061ms)

  /api/user/organizations/organization
    exceptions
      invalid-organizationid
        ✓ missing querystring organizationid (822ms)
        ✓ invalid querystring organizationid (840ms)
      invalid-account
        ✓ accessing account must be organization member (3805ms)
    returns
      ✓ object (1381ms)

  /api/user/organizations/organizations-count
    exceptions
      invalid-accountid
        ✓ missing querystring accountid (788ms)
        ✓ invalid querystring accountid (826ms)
      invalid-account
        ✓ ineligible accessing account (3205ms)
    returns
      ✓ integer (2315ms)

  /api/user/organizations/organizations
    exceptions
      invalid-accountid
        ✓ missing querystring accountid (873ms)
        ✓ invalid querystring accountid (796ms)
      invalid-account
        ✓ ineligible accessing account (3029ms)
    receives
      ✓ optional querystring offset (integer)
      ✓ optional querystring limit (integer)
      ✓ optional querystring all (boolean)
    returns
      ✓ array
    configuration
      ✓ environment PAGE_SIZE

  /api/user/organizations/set-organization-owner
    exceptions
      invalid-organizationid
        ✓ missing querystring organizationid (888ms)
        ✓ invalid querystring organizationid (961ms)
      invalid-accountid
        ✓ posted accountid is missing (1501ms)
        ✓ posted accountid is invalid (1384ms)
      invalid-account
        ✓ accessing account is not organization owner (3197ms)
        ✓ posted accountid is organization owner (1390ms)
        ✓ posted accountid is not member (2245ms)
    returns
      ✓ object (3135ms)

  /api/user/organizations/update-organization
    exceptions
      invalid-organizationid
        ✓ missing querystring organizationid (1535ms)
        ✓ invalid querystring organizationid (796ms)
      invalid-account
        ✓ accessing account is not organization owner (3107ms)
      invalid-organization-name
        ✓ missing posted name (1491ms)
      invalid-organization-name-length
        ✓ posted name is too short (1531ms)
        ✓ posted name is too long (1436ms)
      invalid-organization-email
        ✓ missing posted email (1412ms)
        ✓ invalid posted email (1355ms)
    receives
      ✓ required posted name (1460ms)
      ✓ required posted email (1456ms)
    returns
      ✓ object (1465ms)


  1200 passing (41m)

